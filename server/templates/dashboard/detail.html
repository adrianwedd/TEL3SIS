{% extends "dashboard/layout.html" %}
{% block title %}Call Detail{% endblock %}
{% block content %}
<h1>Call {{ call.call_sid }}</h1>
<p>From: {{ call.from_number }} â†’ {{ call.to_number }}</p>
<p>Summary: {{ call.summary }}</p>
{% if call.self_critique %}
<p>Self Critique: {{ call.self_critique }}</p>
{% endif %}
<audio controls src="{{ audio_path }}"></audio>
<pre id="transcript">{{ transcript }}</pre>
<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
<script>
  const socket = io();
  socket.emit('join', {call_sid: '{{ call.call_sid }}'});
  socket.on('transcript_line', (data) => {
    const pre = document.getElementById('transcript');
    pre.textContent += '\n' + data.speaker + ': ' + data.text;
  });
  window.addEventListener('beforeunload', () => {
    socket.emit('leave', {call_sid: '{{ call.call_sid }}'});
  });
</script>
<p><a href="{{ url_for('dashboard.show_dashboard') }}">Back</a></p>
{% endblock %}
